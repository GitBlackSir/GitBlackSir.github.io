<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="cn">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>基于分布式ID发号器的短网址系统API说明 - 1024bit</title>
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link rel="stylesheet" href="/js/icons/style.css">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" type="image/x-icon" href="/images/contents/fav.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://0.0.0.0:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
  <meta property="og:title" content="基于分布式ID发号器的短网址系统API说明" />
  <meta property="og:description" content="<hr />

" />
  <meta property="og:image" content="http://1024bit.io/images/contents/cat.png" />
  <script>
    var trackOutboundLink = function(url) {
      gtag('event', 'click', {
        'event_category': 'outbound',
        'event_label': url,
        'transport_type': 'beacon',
        'event_callback': function(){document.location = url;}
      });
    }
  </script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="基于分布式ID发号器的短网址系统API说明" />
<meta name="author" content="GitBlackSir" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://0.0.0.0:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
<meta property="og:url" content="http://0.0.0.0:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
<meta property="og:site_name" content="1024bit" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-01T00:00:00-05:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"基于分布式ID发号器的短网址系统API说明","author":{"@type":"Person","name":"GitBlackSir"},"datePublished":"2018-05-01T00:00:00-05:00","dateModified":"2018-05-01T00:00:00-05:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://0.0.0.0:4000/images/contents/cat.png"},"name":"GitBlackSir"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/"},"url":"http://0.0.0.0:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body class="">
  <div id="container">
    <div class="wrap">
    <div id="header">
      <div id="branding">
        <h1 id="site-title">
          <a href="/" title="1024bit" rel="Home">和你谈情怀</a>
        </h1>
      </div>
      <div id="menu-primary" class="menu-container">
        <div class="menu">
          
          <ul id="menu-primary-items">
            <li class="menu-item home"><a class="spec" href="/">首页</a></li>
            <li class="menu-item projects"><a class="spec" href="/projects">项目</a></li>
            <li class="menu-item blog"><a class="spec" href="/blog/">博客</a></li>
            <li class="menu-item talks"><a class="spec" href="/about">关于我</a></li>
            <!--<li class="menu-item github"><a class="spec" href="http://github.com/GitBlackSir/" target="_blank">Github</a></li>-->
          </ul>
          
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div id="main">


<div id="content">
  <div class="hfeed">
    <div class="hentry post">
      <div class="post-content">
        <div class="sticky-header">
          <h1>基于分布式ID发号器的短网址系统API说明</h1>
          
          <div class="byline">May 01, 2018 . <a href="/blog/categories.html#本科毕业设计" class="category">本科毕业设计</a></div>
        </div>

        <div id="toc" class="toc"></div>

        <div class="entry-content">
          <hr />

<h2 id="基于api的示例龙卷风短网址beta">基于API的示例：<a href="http://tinyurl.1024bit.io">龙卷风·短网址Beta</a></h2>

<h3 id="摘要--运行环境">摘要 &amp; 运行环境</h3>
<ul>
  <li><a href="https://github.com/GitBlackSir/Tornado_TinyURL.git"><code class="highlighter-rouge">GitHub</code></a></li>
  <li><code class="highlighter-rouge">Python3.6</code> <code class="highlighter-rouge">Tornado5</code> <code class="highlighter-rouge">SQLAlchemy</code> <code class="highlighter-rouge">Redis</code> <code class="highlighter-rouge">MySQL</code></li>
  <li><code class="highlighter-rouge">--help</code>查看脚本命名说明</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ python3.6 run_api_server --help
</code></pre>
</div>
<ul>
  <li>分别执行<code class="highlighter-rouge">API</code>服务端与<code class="highlighter-rouge">Demo</code><code class="highlighter-rouge">龙卷风·短网址Web系统</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ screen python3.6 run_api_server.py --port=1104 --datacenter=0 --worker=0 &amp;

$ screen python3.6 run_web_server.py &amp;
</code></pre>
</div>

<h3 id="docker">Docker</h3>
<ul>
  <li>Coding…Dockerfile</li>
</ul>

<hr />

<h2 id="api返回json数据说明">API返回JSON数据说明</h2>

<h3 id="获取全局唯一id短网址后缀api返回json示例">获取全局唯一ID/短网址后缀API返回JSON示例</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;get-id-url</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 0,
	"messages": "SUCCESSFUL!",
	"id": 4091465116246081537,
	"short_url": "4SeX7N2RNYt",
	"time": 1525762899.459599,
	"data_center_id": 0,
	"worker_id": 0,
}
</code></pre>
</div>

<blockquote>
  <ul>
    <li>“status”:
      <ul>
        <li>0 <code class="highlighter-rouge">请求成功</code>
          <ul>
            <li>messages”: “SUCCESSFUL!”</li>
            <li>“id”:  4091465116246081537, <code class="highlighter-rouge">由分布式发号器计算出的64bit整数</code></li>
            <li>“short_url”: “4SeX7N2RNYt”, <code class="highlighter-rouge">64bit整数转62进制[0-9a-zA-Z]字符串</code></li>
            <li>“time”: 1525762899.459599, <code class="highlighter-rouge">unix当前时间戳毫秒</code></li>
            <li>“data_center_id”:0 <code class="highlighter-rouge">分布式进程所在数据中心集群ID</code></li>
            <li>“worker_id”:0 <code class="highlighter-rouge">分布式进程所在工作机器，可理解进为程标识码ID</code></li>
          </ul>
        </li>
        <li>1 <code class="highlighter-rouge">请求失败</code>
          <ul>
            <li>messages”: “ERROR!”</li>
            <li>“id”: None</li>
            <li>“short_url”: None</li>
            <li>“time”: 1525087234.847292</li>
            <li>“data_center_id”:0</li>
            <li>“worker_id”:0</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h3 id="长网址压缩api返回json示例">长网址压缩API返回JSON示例</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;convert=<code class="highlighter-rouge">URL</code></strong></p>

<p><code class="highlighter-rouge">URL</code>:所需转换的长网址</p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 3,
	"messages": "SUCCESSFUL SHORT_URL FROM API!",
	"short_url": "http://t.1024bit.io/4SeXcf5cBsl"
}
</code></pre>
</div>
<blockquote>
  <ul>
    <li>“status”:
      <ul>
        <li>0 “messages”: “EMPTY URL!”,”short_url”: None</li>
        <li>1 “messages”: “FORBID INPUT TINYURL!”,”short_url”: None</li>
        <li>2 “messages”: “SUCCESSFUL SHORT_URL FROM REDIS!”,”short_url”: “http://t.1024bit.io/4SeXcf5cBsl”</li>
        <li>3 “messages”: “SUCCESSFUL SHORT_URL FROM API!”,”short_url”: “http://t.1024bit.io/4SeXcf5cBsl”</li>
        <li>4 “messages”: “URL INPUT ERROR!”,”short_url”: None</li>
        <li>5 “messages”: “URL ERROR!”,”short_url”: None</li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h3 id="短网址还原api返回json示例">短网址还原API返回JSON示例</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;restore=<code class="highlighter-rouge">URL</code></strong></p>

<p><code class="highlighter-rouge">URL</code>:所需转换的短网址</p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 1,
	"messages": "SUCCESSFULL!",
	"long_url": "https://aceld.gitbooks.io/libevent/content/"
	}
</code></pre>
</div>
<blockquote>
  <ul>
    <li>“status”:
      <ul>
        <li>0 “messages”: “EMPTY URL!”,”long_url”: None</li>
        <li>1 “messages”: “SUCCESSFULL!”,”long_url”:”http://google.com/ncr”</li>
        <li>2 “messages”: “URL ERROR! http://t.1024bit.io/+xxxxx”,”long_url”: None</li>
        <li>3 “messages”: “URL ERROR!”,”long_url”: None</li>
        <li>4 “messages”: “URL ERROR!”,”long_url”: None</li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h2 id="python-客户端">Python 客户端</h2>

<h3 id="请求示例">请求示例</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>for i in range(100):
    print(Client('tinyurl-api.1024bit.io',80).get_id())
</code></pre>
</div>

<h3 id="代码">代码</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>import json
import requests
class Client(object):
    def __init__(self, host, port, url = ''):
        self.url = url
        self.host = host
        self.port = port
        self.api_develop = 'http://%s:%s/json&amp;get-id-url' % (self.host, self.port)
        self.api_user_get_tinyurl = 'http://%s:%s/json&amp;convert=%s/' %(self.host,self.port,self.url)
        self.api_user_get_longurl = 'http://%s:%s/json&amp;restore=%s/' %(self.host,self.port,self.url)

    def get_id(self):
        res = requests.get(self.api_develop)
        return json.loads(res.text)

    def get_tinyurl(self):
        res = requests.get(self.api_user_get_tinyurl)
        return json.loads(res.text)
    def get_longurl(self):
        res = requests.get(self.api_user_get_longurl)
        return json.loads(res.text)
</code></pre>
</div>


        </div>

        <!-- 
 -->
      </div>
    </div>
  </div>
</div><!-- #content -->

      </div><!-- #main -->

      <div class="clear"></div>

      <div id="fotterLinks">
        <a href="https://github.com/GitBlackSir/" alt="GitHub" target="_blank" >GitHub</a>
<!--         |
        <a href="https://www.gitbook.com/@gitblacksir" alt="GitBook" target="_blank" >GitBook</a> -->
        |
        <a href="http://twitter.com/GitBlackSir/" alt="Twitter" target="_blank" >Twitter</a>
        |
        <a href="mailto:admin@1024bit.io" alt="email" target="_blank">Email</a>
      </div>

      <div id="copyright">
        &copy; 2017–2019 <a href="http://1024bit.io/">1024bit</a>. All rights reserved.
      </div>
    </div><!-- .wrap -->
  </div><!-- #container -->

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/toc/toc.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.toc').toc({
        title: '',
        listType: 'ol',
        minimumHeaders: 2,
        headers: 'h2, h3, h4, h5, h6',
        linkHere: true,
        linkHereTitle: 'Link here',
        backToTop: true,
        backToTopId: 'toc',
        backToTopTitle: 'Back to Table of Contents',
      });
      $('.jekyll-toc-header a.jekyll-toc-link-here span.jekyll-toc-icon').addClass('icon icon-link');
      $('.jekyll-toc-header a.jekyll-toc-back-to-top span.jekyll-toc-icon').addClass('icon icon-chevron-up');
    });
  </script>
</body>
</html>

