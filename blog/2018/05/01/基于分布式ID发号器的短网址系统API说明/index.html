<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="cn">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>åŸºäºåˆ†å¸ƒå¼IDå‘å·å™¨çš„çŸ­ç½‘å€ç³»ç»ŸAPIè¯´æ˜ - 1024bit</title>
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <link rel="stylesheet" type="text/css" href="/css/syntax.css" />
  <link rel="stylesheet" href="/js/icons/style.css">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="shortcut icon" type="image/x-icon" href="/images/contents/fav.png" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="http://localhost:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
  <meta property="og:title" content="åŸºäºåˆ†å¸ƒå¼IDå‘å·å™¨çš„çŸ­ç½‘å€ç³»ç»ŸAPIè¯´æ˜" />
  <meta property="og:description" content="<hr />

" />
  <meta property="og:image" content="http://1024bit.io/images/contents/cat.png" />
  <script>
    var trackOutboundLink = function(url) {
      gtag('event', 'click', {
        'event_category': 'outbound',
        'event_label': url,
        'transport_type': 'beacon',
        'event_callback': function(){document.location = url;}
      });
    }
  </script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <!-- Begin Jekyll SEO tag v2.2.3 -->
<meta property="og:title" content="åŸºäºåˆ†å¸ƒå¼IDå‘å·å™¨çš„çŸ­ç½‘å€ç³»ç»ŸAPIè¯´æ˜" />
<meta name="author" content="baiyuNinja" />
<meta property="og:locale" content="en_US" />
<link rel="canonical" href="http://localhost:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
<meta property="og:url" content="http://localhost:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/" />
<meta property="og:site_name" content="1024bit" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-05-01T00:00:00+08:00" />
<script type="application/ld+json">
{"@context":"http://schema.org","@type":"BlogPosting","headline":"åŸºäºåˆ†å¸ƒå¼IDå‘å·å™¨çš„çŸ­ç½‘å€ç³»ç»ŸAPIè¯´æ˜","author":{"@type":"Person","name":"baiyuNinja"},"datePublished":"2018-05-01T00:00:00+08:00","dateModified":"2018-05-01T00:00:00+08:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/images/contents/cat.png"},"name":"baiyuNinja"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/"},"url":"http://localhost:4000/blog/2018/05/01/%E5%9F%BA%E4%BA%8E%E5%88%86%E5%B8%83%E5%BC%8FID%E5%8F%91%E5%8F%B7%E5%99%A8%E7%9A%84%E7%9F%AD%E7%BD%91%E5%9D%80%E7%B3%BB%E7%BB%9FAPI%E8%AF%B4%E6%98%8E/"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body class="">
  <div id="container">
    <div class="wrap">
    <div id="header">
      <div id="branding">
        <h1 id="site-title">
          <a href="/" title="1024bit" rel="Home">ğŸ­</a>
        </h1>
      </div>
      <div id="menu-primary" class="menu-container">
        <div class="menu">

          <ul id="menu-primary-items">
            <li class="menu-item home"><a class="spec" href="/">é¦–é¡µ</a></li>
            <li class="menu-item projects"><a class="spec" href="/projects">é¡¹ç›®</a></li>
            <li class="menu-item blog"><a class="spec" href="/blog/">åšå®¢</a></li>
            <li class="menu-item talks"><a class="spec" href="/about">å…³äºæˆ‘</a></li>
            <!--<li class="menu-item github"><a class="spec" href="http://github.com/GitBlackSir/" target="_blank">Github</a></li>-->
          </ul>
          
        </div>
      </div>
      <div class="clear"></div>
    </div>
    <div id="main">


<div id="content">
  <div class="hfeed">
    <div class="hentry post">
      <div class="post-content">
        <div class="sticky-header">
          <h1>åŸºäºåˆ†å¸ƒå¼IDå‘å·å™¨çš„çŸ­ç½‘å€ç³»ç»ŸAPIè¯´æ˜</h1>
          
          <div class="byline">May 01, 2018 . <a href="/blog/categories.html#æœ¬ç§‘æ¯•ä¸šè®¾è®¡" class="category">æœ¬ç§‘æ¯•ä¸šè®¾è®¡</a></div>
        </div>

        <div id="toc" class="toc"></div>

        <div class="entry-content">
          <hr />

<h2 id="åŸºäºapiçš„ç¤ºä¾‹é¾™å·é£çŸ­ç½‘å€beta">åŸºäºAPIçš„ç¤ºä¾‹ï¼š<a href="http://tinyurl.1024bit.io">é¾™å·é£Â·çŸ­ç½‘å€Beta</a></h2>

<h3 id="æ‘˜è¦--è¿è¡Œç¯å¢ƒ">æ‘˜è¦ &amp; è¿è¡Œç¯å¢ƒ</h3>
<ul>
  <li><a href="https://github.com/GitBlackSir/Tornado_TinyURL.git"><code class="highlighter-rouge">GitHub</code></a></li>
  <li><code class="highlighter-rouge">Python3.6</code> <code class="highlighter-rouge">Tornado5</code> <code class="highlighter-rouge">SQLAlchemy</code> <code class="highlighter-rouge">Redis</code> <code class="highlighter-rouge">MySQL</code></li>
  <li><code class="highlighter-rouge">--help</code>æŸ¥çœ‹è„šæœ¬å‘½åè¯´æ˜</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ python3.6 run_api_server --help
</code></pre>
</div>
<ul>
  <li>åˆ†åˆ«æ‰§è¡Œ<code class="highlighter-rouge">API</code>æœåŠ¡ç«¯ä¸<code class="highlighter-rouge">Demo</code><code class="highlighter-rouge">é¾™å·é£Â·çŸ­ç½‘å€Webç³»ç»Ÿ</code></li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>$ screen python3.6 run_api_server.py --port=1104 --datacenter=0 --worker=0 &amp;

$ screen python3.6 run_web_server.py &amp;
</code></pre>
</div>

<h3 id="docker">Docker</h3>
<ul>
  <li>Codingâ€¦Dockerfile</li>
</ul>

<hr />

<h2 id="apiè¿”å›jsonæ•°æ®è¯´æ˜">APIè¿”å›JSONæ•°æ®è¯´æ˜</h2>

<h3 id="è·å–å…¨å±€å”¯ä¸€idçŸ­ç½‘å€åç¼€apiè¿”å›jsonç¤ºä¾‹">è·å–å…¨å±€å”¯ä¸€ID/çŸ­ç½‘å€åç¼€APIè¿”å›JSONç¤ºä¾‹</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;get-id-url</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 0,
	"messages": "SUCCESSFUL!",
	"id": 4091465116246081537,
	"short_url": "4SeX7N2RNYt",
	"time": 1525762899.459599,
	"data_center_id": 0,
	"worker_id": 0,
}
</code></pre>
</div>

<blockquote>
  <ul>
    <li>â€œstatusâ€:
      <ul>
        <li>0 <code class="highlighter-rouge">è¯·æ±‚æˆåŠŸ</code>
          <ul>
            <li>messagesâ€: â€œSUCCESSFUL!â€</li>
            <li>â€œidâ€:  4091465116246081537, <code class="highlighter-rouge">ç”±åˆ†å¸ƒå¼å‘å·å™¨è®¡ç®—å‡ºçš„64bitæ•´æ•°</code></li>
            <li>â€œshort_urlâ€: â€œ4SeX7N2RNYtâ€, <code class="highlighter-rouge">64bitæ•´æ•°è½¬62è¿›åˆ¶[0-9a-zA-Z]å­—ç¬¦ä¸²</code></li>
            <li>â€œtimeâ€: 1525762899.459599, <code class="highlighter-rouge">unixå½“å‰æ—¶é—´æˆ³æ¯«ç§’</code></li>
            <li>â€œdata_center_idâ€:0 <code class="highlighter-rouge">åˆ†å¸ƒå¼è¿›ç¨‹æ‰€åœ¨æ•°æ®ä¸­å¿ƒé›†ç¾¤ID</code></li>
            <li>â€œworker_idâ€:0 <code class="highlighter-rouge">åˆ†å¸ƒå¼è¿›ç¨‹æ‰€åœ¨å·¥ä½œæœºå™¨ï¼Œå¯ç†è§£è¿›ä¸ºç¨‹æ ‡è¯†ç ID</code></li>
          </ul>
        </li>
        <li>1 <code class="highlighter-rouge">è¯·æ±‚å¤±è´¥</code>
          <ul>
            <li>messagesâ€: â€œERROR!â€</li>
            <li>â€œidâ€: None</li>
            <li>â€œshort_urlâ€: None</li>
            <li>â€œtimeâ€: 1525087234.847292</li>
            <li>â€œdata_center_idâ€:0</li>
            <li>â€œworker_idâ€:0</li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h3 id="é•¿ç½‘å€å‹ç¼©apiè¿”å›jsonç¤ºä¾‹">é•¿ç½‘å€å‹ç¼©APIè¿”å›JSONç¤ºä¾‹</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;convert=<code class="highlighter-rouge">URL</code></strong></p>

<p><code class="highlighter-rouge">URL</code>:æ‰€éœ€è½¬æ¢çš„é•¿ç½‘å€</p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 3,
	"messages": "SUCCESSFUL SHORT_URL FROM API!",
	"short_url": "http://t.1024bit.io/4SeXcf5cBsl"
}
</code></pre>
</div>
<blockquote>
  <ul>
    <li>â€œstatusâ€:
      <ul>
        <li>0 â€œmessagesâ€: â€œEMPTY URL!â€,â€short_urlâ€: None</li>
        <li>1 â€œmessagesâ€: â€œFORBID INPUT TINYURL!â€,â€short_urlâ€: None</li>
        <li>2 â€œmessagesâ€: â€œSUCCESSFUL SHORT_URL FROM REDIS!â€,â€short_urlâ€: â€œhttp://t.1024bit.io/4SeXcf5cBslâ€</li>
        <li>3 â€œmessagesâ€: â€œSUCCESSFUL SHORT_URL FROM API!â€,â€short_urlâ€: â€œhttp://t.1024bit.io/4SeXcf5cBslâ€</li>
        <li>4 â€œmessagesâ€: â€œURL INPUT ERROR!â€,â€short_urlâ€: None</li>
        <li>5 â€œmessagesâ€: â€œURL ERROR!â€,â€short_urlâ€: None</li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h3 id="çŸ­ç½‘å€è¿˜åŸapiè¿”å›jsonç¤ºä¾‹">çŸ­ç½‘å€è¿˜åŸAPIè¿”å›JSONç¤ºä¾‹</h3>

<p><strong>http://tinyurl-api.1024bit.io/json&amp;restore=<code class="highlighter-rouge">URL</code></strong></p>

<p><code class="highlighter-rouge">URL</code>:æ‰€éœ€è½¬æ¢çš„çŸ­ç½‘å€</p>

<div class="highlighter-rouge"><pre class="highlight"><code>json = {
	"status": 1,
	"messages": "SUCCESSFULL!",
	"long_url": "https://aceld.gitbooks.io/libevent/content/"
	}
</code></pre>
</div>
<blockquote>
  <ul>
    <li>â€œstatusâ€:
      <ul>
        <li>0 â€œmessagesâ€: â€œEMPTY URL!â€,â€long_urlâ€: None</li>
        <li>1 â€œmessagesâ€: â€œSUCCESSFULL!â€,â€long_urlâ€:â€http://google.com/ncrâ€</li>
        <li>2 â€œmessagesâ€: â€œURL ERROR! http://t.1024bit.io/+xxxxxâ€,â€long_urlâ€: None</li>
        <li>3 â€œmessagesâ€: â€œURL ERROR!â€,â€long_urlâ€: None</li>
        <li>4 â€œmessagesâ€: â€œURL ERROR!â€,â€long_urlâ€: None</li>
      </ul>
    </li>
  </ul>
</blockquote>

<hr />

<h2 id="python-å®¢æˆ·ç«¯">Python å®¢æˆ·ç«¯</h2>

<h3 id="è¯·æ±‚ç¤ºä¾‹">è¯·æ±‚ç¤ºä¾‹</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>for i in range(100):
    print(Client('tinyurl-api.1024bit.io',80).get_id())
</code></pre>
</div>

<h3 id="ä»£ç ">ä»£ç </h3>

<div class="highlighter-rouge"><pre class="highlight"><code>import json
import requests
class Client(object):
    def __init__(self, host, port, url = ''):
        self.url = url
        self.host = host
        self.port = port
        self.api_develop = 'http://%s:%s/json&amp;get-id-url' % (self.host, self.port)
        self.api_user_get_tinyurl = 'http://%s:%s/json&amp;convert=%s/' %(self.host,self.port,self.url)
        self.api_user_get_longurl = 'http://%s:%s/json&amp;restore=%s/' %(self.host,self.port,self.url)

    def get_id(self):
        res = requests.get(self.api_develop)
        return json.loads(res.text)

    def get_tinyurl(self):
        res = requests.get(self.api_user_get_tinyurl)
        return json.loads(res.text)
    def get_longurl(self):
        res = requests.get(self.api_user_get_longurl)
        return json.loads(res.text)
</code></pre>
</div>


        </div>

        <!-- 
 -->
      </div>
    </div>
  </div>
</div><!-- #content -->

      </div><!-- #main -->
    
      <div class="clear"></div>
    
      <div id="fotterLinks">
        <a href="https://github.com/baiyuNinja/" alt="GitHub" target="_blank" >GitHub</a>
        |
        <a href="mailto:admin@1024bit.io" alt="email" target="_blank">Email</a>
      </div>

      <div id="copyright">
        &copy; 2017â€“2020 <a href="https://blog.1024bit.io/">1024BitğŸ¦™</a>. All rights reserved.
      </div>
    </div><!-- .wrap -->
  </div><!-- #container -->

  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
  <script src="/js/toc/toc.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('.toc').toc({
        title: '',
        listType: 'ol',
        minimumHeaders: 2,
        headers: 'h2, h3, h4, h5, h6',
        linkHere: true,
        linkHereTitle: 'Link here',
        backToTop: true,
        backToTopId: 'toc',
        backToTopTitle: 'Back to Table of Contents',
      });
      $('.jekyll-toc-header a.jekyll-toc-link-here span.jekyll-toc-icon').addClass('icon icon-link');
      $('.jekyll-toc-header a.jekyll-toc-back-to-top span.jekyll-toc-icon').addClass('icon icon-chevron-up');
    });
  </script>
</body>
</html>

